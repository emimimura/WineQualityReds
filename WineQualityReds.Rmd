---
output:
  html_document:
    css: style.css
---

# The Secret to Good Red Wine by Emi Pires

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
library(ggplot2)
library(dplyr)
library(gridExtra)
library(GGally)
library(grid)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
red <- read.csv("wineQualityreds.csv")
```

<p>The dataset contains red wines with the chemical properties of the wine. 
At least 3 wine experts rated the quality of each wine, providing a rating 
between 0 (very bad) and 10 (very excellent).</p>

<p>Input variables (based on physicochemical tests):<br>
   1 - fixed acidity (tartaric acid - g / dm^3)<br>
   2 - volatile acidity (acetic acid - g / dm^3)<br>
   3 - citric acid (g / dm^3)<br>
   4 - residual sugar (g / dm^3)<br>
   5 - chlorides (sodium chloride - g / dm^3<br>
   6 - free sulfur dioxide (mg / dm^3)<br>
   7 - total sulfur dioxide (mg / dm^3)<br>
   8 - density (g / cm^3)<br>
   9 - pH<br>
   10 - sulphates (potassium sulphate - g / dm3)<br>
   11 - alcohol (% by volume)<br>
   Output variable (based on sensory data): <br>
   12 - quality (score between 0 and 10)</p>

## Univariate Plots Section

### Structure and summary of the data

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots}
str(red)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
sum(is.na(red))
```

<p>This data consists 1599 observations and 13 columns, and with the 1st column 
being an index, there are 12 variables. No missing value was found.</p>

#### Distribution: Fixed Acidity
<p class="box"><b>Fixed Acidity</b>: most acids involved with wine or fixed or 
nonvolatile (do not evaporate readily)</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=fixed.acidity)) +
  geom_histogram(bins=100),
  ggplot(data=red, aes(x=1, y=fixed.acidity)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$fixed.acidity)
```

<p>Distribution of fixed acidity is slightly right-skewed, and its peak marks 
around 7 and 8. It contains many outliers, creating a huge gap between the 3rd 
quartile(9.20) and max number(15.90) compread to the difference between the 
minimum number(4.60) and the 1st quartile(7.10).</p> 

#### Distribution: Volatile Acidity
<p class="box"><b>Volatile Acidity</b>: the amount of acetic acid in wine, which 
at too high of levels can lead to an unpleasant, vinegar taste</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=volatile.acidity)) +
  geom_histogram(bins=60),
  ggplot(data=red, aes(x=1, y=volatile.acidity)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$volatile.acidity)
```

<p>Right skewed distribution. I also see a few outliers. Let's investigate the 
furthest outlier.</p> 

```{r echo=FALSE, message=FALSE, warning=FALSE}
filter(red, volatile.acidity == max(volatile.acidity))
```

<p>It doesn't look like I need to remove it for now, but I also see that the 
quality is scored "3", which is the worst in this dataset and backs up the 
description of this attribute.</p>

#### Distribution: Citric Acid
<p class="box"><b>Citric Acid</b>: found in small quantities, citric acid can 
add 'freshness' and flavor to wines</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=citric.acid)) +
  geom_histogram(bins=50),
  ggplot(data=red, aes(x=1, y=citric.acid)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$citric.acid)
```

<p>This is far from normal distribution. The highest peak is actually at 0, 
and the second highest at 0.5. I wonder what that outlier looks like:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
filter(red, citric.acid == max(citric.acid))
```

<p>It doesn't seem like that high level of this attribute contributes to the 
quality of wine.</p>

#### Distribution: Residual Sugar
<p class="box"><b>Residual Sugar</b>: the amount of sugar remaining after 
fermentation stops, it's rare to find wines with less than 1 gram/liter and 
wines with greater than 45 grams/liter are considered sweet</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=residual.sugar)) +
  geom_histogram(bins=50),
  ggplot(data=red, aes(x=1, y=residual.sugar)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$residual.sugar)
```

<p>So many outliers and heavely skewed. The majority is distributed around 1.9 
to 2.6, and the tail of outliers goes out far away till 15.5. What does it look 
like if I removed all the extremes? I'll plot a distribution of IQR.</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=red, aes(x=residual.sugar)) +
  geom_histogram(bins = 30) +
  xlim(1.9, 2.6)
```
<p>This tells me the differnce in the IQR is pretty moderate, except that I see 
alarmingly low count in numbers in 2 decimal places (i.g. 2.05, 2.15 etc.). 
What makes the low ones exceptionally low? I also want to see what happens when 
I log-transform the original histogram:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=red, aes(x=residual.sugar)) +
  geom_histogram(bins=50) +
  scale_x_continuous(trans = "log2")
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(log10(red$residual.sugar))
```

<p>This looks much better, though it still has a long tail on the right side.</p>

#### Distribution: Chlorides
<p class="box"><b>Chlorides</b>: the amount of salt in the wine</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=chlorides)) +
  geom_histogram(bins=50),
  ggplot(data=red, aes(x=1, y=chlorides)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$chlorides)
```

<p>Again, many outliers. Here's what happens when I log-transform the 
histogram.</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=red, aes(x=chlorides)) +
  geom_histogram(bins=50) +
  scale_x_continuous(trans = "log10")
```

<p>Looks more normal, and the majority are around 0.075 to 0.1.</p>

#### Distribution: Free Sulfur Dioxide
<p class="box"><b>Free Sulfur Dioxide</b>: the free form of SO2 exists in 
equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it 
prevents microbial growth and the oxidation of wine</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=free.sulfur.dioxide)) +
  geom_histogram(bins=100),
  ggplot(data=red, aes(x=1, y=free.sulfur.dioxide)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$free.sulfur.dioxide)
```

<p>Right skewed distribution with many outliers.</p>

#### Distribution: Total Sulfur Dioxide
<p class="box"><b>Total Sulfur Dioxide</b>: amount of free and bound forms of 
S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 
concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=total.sulfur.dioxide)) +
  geom_histogram(bins=100),
  ggplot(data=red, aes(x=1, y=total.sulfur.dioxide)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$total.sulfur.dioxide)
```

<p>Heavely skewed again, and there are extreme outliers. If I take out those two 
outliers:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
tsd.sub <- filter(red, total.sulfur.dioxide < 200)
grid.arrange(ggplot(data=tsd.sub, aes(x=total.sulfur.dioxide)) +
  geom_histogram(bins=100),
  ggplot(data=tsd.sub, aes(x=1, y=total.sulfur.dioxide)) +
    geom_boxplot(), nrow=1)
```

<p>When I look at the distribution in log10 scale:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=tsd.sub, aes(x=total.sulfur.dioxide)) +
  geom_histogram(bins=40) +
  scale_x_continuous(trans = "log10")
```

<p>This is closer to a normal distribution, with the highest count around 40.</p>

#### Distribution: Density
<p class="box"><b>Density</b>: the density of water is close to that of water 
depending on the percent alcohol and sugar content</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=density)) +
  geom_histogram(bins=60),
  ggplot(data=red, aes(x=1, y=density)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$density)
```

<p>This is a better looking distribution. Median 0.9968 and Mean 0.9967 so close 
to gether, this is almost a normal distribution.</p>

#### Distribution: pH
<p class="box"><b>pH</b>: describes how acidic or basic a wine is on a scale 
from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH 
scale</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=pH)) +
  geom_histogram(bins=60),
  ggplot(data=red, aes(x=1, y=pH)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$pH)
```

<p>Another good looking distribution that is close to normal. Outliers on both 
end that I can possible take out. </p>

#### Distribution: Sulphates
<p class="box"><b>Sulphates</b>: a wine additive which can contribute to sulfur 
dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=sulphates)) +
  geom_histogram(bins=70),
  ggplot(data=red, aes(x=1, y=sulphates)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$sulphates)
```

<p>When I log-scale it:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=tsd.sub, aes(x=sulphates)) +
  geom_histogram(bins=50) +
  scale_x_continuous(trans = "log2")
```

<p>Median stands out in the distribution and gradually decreases to 1, and after 
that is a long tail of outliers.</p>

#### Distribution: Alcohol
<p class="box"><b>Alcohol</b>: the percent alcohol content of the wine</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
grid.arrange(ggplot(data=red, aes(x=alcohol)) +
  geom_histogram(bins=70),
  ggplot(data=red, aes(x=1, y=alcohol)) +
    geom_boxplot(), nrow=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$alcohol)
```

<p>The count decreases as the level of alcohol increases. The peak is between 
9 and 10.</p>

#### Distribution: Quality
<p class="box"><b>Quality</b>: score between 0 and 10</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=red, aes(x=quality)) +
  geom_bar()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(red$quality)
```

<p>I can see that the majority of wine were scored between 5 and 6. No wines 
were below 3 or above 8.</p>

#### Distribution: Low and High Quality

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Filtering the dataset to use only rows which quality are 3, 4, 7, or 8. 
no.normal <- red %>%
              filter(quality >=7 | quality <= 4) %>%
              mutate(quality.group =
                ifelse(quality <= 4, "poor","excellent"))

no.normal$quality.group <- factor(no.normal$quality.group, 
                                  levels = c("poor", "excellent"))

ggplot(data=no.normal, aes(x=quality.group, fill = quality.group)) +
  geom_bar()
```

<p>When I exclude the quality 5 and 6, and combined the 3 and 4 into a class 
called "poor" and 7 and 8 into a class "excellent", I see most were rated high 
than low.</p>

## Univariate Analysis

<p class="question">What is the structure of your dataset?</p>
<p class="answer">The dataset has 13 columns and 1599 rows, and has 12 variables. 
1 categorical variable, which is "quality", and the rest are continuous 
numerical variables.The quality scores go from 0 (lowest) to 10 (highest). Most 
wines score between 5 and 6, and few are labels as excellent or poor.</p>

<p class="question">What is/are the main feature(s) of interest in your 
dataset?</p>
<p class="answer">The main feature of interest would be attributes that are 
directly correlated to the quality of wines. Attributes such as volatile 
acidity would have quite direct influence. For example, volatile acidity too 
high of levels can lead to an unpleasant, and 
<a href="http://waterhouse.ucdavis.edu/whats-in-wine/fixed-acidity">Waterhouse 
Lab</a> explains that acids impart the sourness or tartness that is a fundamental 
feature in wine taste.</p> 

<p class="question">What other features in the dataset do you think will help 
support your investigation into your feature(s) of interest?</p>
<p class="answer">Finding combinations of attributes that make good wine.</p>

<p class="question">Did you create any new variables from existing variables in 
the dataset?</p>
<p class="answer">Not at this time, but I would as needed in the process.</p>

<p class="question">Of the features you investigated, were there any unusual 
distributions? Did you perform any operations on the data to tidy, adjust, or 
change the form of the data? If so, why did you do this?</p>
<p class="answer">On residual sugar plot, I set the x limit within IQR to take a 
closer look at the majority, because it was heavily right skewed and there were 
so many outliers. I then log-tranformed it to look at the original plot again to 
better look at the tail of the distribution. The same process was applied to 
total sulfur dioxide. I also log-transformed the chlorides and sulphates plots 
to since their right skewed distributions had quite wide ranges.</p>

## Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots}
# Function to plot
plot_quality <- function(attribute, yaxis_name) {
  ggplot(red, aes(x = factor(quality), y = attribute)) +
    geom_boxplot() +
    ylab(yaxis_name)
}
```

### Comparison of Quality by Attributes
Before getting into each plot, I'm going to take a look at the whole dataset 
for over-all comparison.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=8}
p1 <- plot_quality(red$fixed.acidity, "fixed.acidity")
p2 <- plot_quality(red$volatile.acidity, "volatile.acidity")
p3 <- plot_quality(red$citric.acid, "citric.acid")
p4 <- plot_quality(red$residual.sugar, "residual.sugar")
p5 <- plot_quality(red$chlorides, "chlorides")
p6 <- plot_quality(red$free.sulfur.dioxide, "free.sulfur.dioxide")
p7 <- plot_quality(red$total.sulfur.dioxide, "total.sulfur.dioxide")
p8 <- plot_quality(red$density, "density")
p9 <- plot_quality(red$pH, "pH")
p10 <- plot_quality(red$sulphates, "sulphates")
p11 <- plot_quality(red$alcohol, "alcohol")

grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, ncol=4)
```

<p>From this comparison, the attributes that may positively affect the 
quality of wine are volatile acidity, citric acid, density, pH, sulphates, and 
alcohol.</p>

#### Focusing on the Extremes
<p>Because most of the wines were rated 5 and 6, it's a little hard to see which 
attributes make "poor" and "excellent" wines. I'm going to subset the data so I 
can focus on those extreme cases.</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Function to create the plot
plot_att1 <- function(attribute, attribute_name) {
  ggplot(no.normal, aes(x=quality.group, y=attribute, fill=quality.group)) +
  geom_jitter( alpha = 0.5, color="#7a0011")  + 
  geom_boxplot( alpha = 0.8) + 
  scale_fill_manual(values=c("#888888", "#E69F00")) +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "white", 
               shape = 8, 
               size = 5) +
             theme(axis.text.x = element_text(hjust = 1)) +
  labs(x = "Quality Group", y = attribute_name)
}

plot_att1(no.normal$alcohol, "alcohol")
```
<p>This is much easier to see the difference in the quality. I'm going to check 
the rest of attributes.</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=15, fig.width=12}
p1 <- plot_att1(no.normal$fixed.acidity, "fixed.acidity")
p2 <- plot_att1(no.normal$volatile.acidity, "volatile.acidity")
p3 <- plot_att1(no.normal$citric.acid, "citric.acid")
p4 <- plot_att1(no.normal$residual.sugar, "residual.sugar")
p5 <- plot_att1(no.normal$chlorides, "chlorides")
p6 <- plot_att1(no.normal$free.sulfur.dioxide, "free.sulfur.dioxide")
p7 <- plot_att1(no.normal$total.sulfur.dioxide, "total.sulfur.dioxide")
p8 <- plot_att1(no.normal$density, "density")
p9 <- plot_att1(no.normal$pH, "pH")
p10 <- plot_att1(no.normal$sulphates, "sulphates")

grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, ncol=2)
```

<p>With this plot, I can see the bigger quality distinctions are observed 
with:<br>
- alcohol (excellent wines have higher alcohol)<br>
- volatile acidity (excellent wines have lower volatile acidity)<br>
- citric acidity (excellent wines have higher citric acid)<br>
- sulphates (excellent wines have higher sulphates)</p>

#### Correlation Plot
<p>First running on the original dataset, then comparing it with the one without 
the "normal" wines.</p>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12}
p1 <- ggcorr(red, palette = "RdBu", label = TRUE, 
             label_size = 4, size = 3)
p2 <- ggcorr(no.normal, palette = "RdBu", label = TRUE,  
             label_size = 4, size = 3)

grid.arrange(p1, p2, ncol=2)
```
<p>The first one on the left confirms my observation on alcohol with its 
stronger correlation with quality. The second on on the right also confirms my 
observation on the boxplots comparison where alcohol, volatile acidity, citric 
acid, and sulphates made difference in extremes. Some numbers of attributes with 
each other also changed, and when they did, most of the correlation became 
stronger.</p>



## Bivariate Analysis

<p class="question">Talk about some of the relationships you observed in this 
part of the investigation. How did the feature(s) of interest vary with other 
features in the dataset?</p>
<p class="answer">First, I investigated the relationship of quality and each 
attribute, but the initial plot that displays all observations showed  that the 
only attribute with a decent correlation was alcohol â€” the quality seems to go 
up as the alcohol level did as well. The boxplot confirmed that the median and 
mean did indeed went up as the quality did, but only from score 5 to 8. The 
correlation test confirmed it was approximately 0.48. But when I removed the 
wines scored 5 and 6 from the plot to focus on the ones scored below 5 and above 
6, I found there were more attributes that produced noteworthy difference in 
quality.</p>

<p class="question">Did you observe any interesting relationships between the 
other features (not the main feature(s) of interest)?</p>
<p class="answer">The relationships with other attributes besides the quality. 
Some had stronger correlations with each other than with the quality, and I 
wonder if that indicates the attributes' influence on each other and that's what 
determines the quality of wine. They also got stronger when I used a subset 
without the ones scored 5 and 6.</p>

<p class="question">What was the strongest relationship you found?</p>
<p class="answer">The ones with stronger correlations from the original dataset
(-0.7 > and 0.7 <):<br>
- pH and fixed acidity<br>
- density and fixed acidity <br>
- total sulfur dioxide and free fulfur dioxide<br>
- citric acid and fixed acidity</p>

## Multivariate Plots Section

First, I'm going to compare alcohol with density by excellent and poor wines. 
At this point, since my main interest is finding out what makes these distinct 
wines, I'll exclude the quality 5 and 6 from these plots.</p>

#### Density and Alcohol by Quality

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = density, y = alcohol, color=quality.group)) +
    geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
    geom_smooth(method = "lm", se = FALSE,size=1)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Calculating correlation coefficient
cor.test(no.normal$density, no.normal$alcohol, method= "pearson")
```

<p>Density has the strongest correlation with alcohol, and the combination shows 
a clear seperation between the two quality groups. Now I'm going to compare the 
four pairs with the strongest correlations.<br>
- pH and fixed acidity<br>
- density and fixed acidity <br>
- total sulfur dioxide and free fulfur dioxide<br>
- citric acid and fixed acidity</p>

#### pH and Fixed Acidity

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = pH, y = fixed.acidity, color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
cor.test(no.normal$pH, no.normal$fixed.acidity, method= "pearson")
```

<p>They have a pretty strong correlation with each other, but that doesn't seem 
to directly affect on the quality.</p>

#### Density and Fixed Acidity
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = density, y = fixed.acidity, color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
cor.test(no.normal$density, no.normal$fixed.acidity, method= "pearson")
```
<p>Here is another strong, correlation, and the seperation of the two quality 
groups is more apparent.</p>

#### Total Sulfur Dioxide and Free Sulfur Dioxide

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = total.sulfur.dioxide, y = free.sulfur.dioxide, 
                      color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Calculating correlation coefficient
cor.test(no.normal$total.sulfur.dioxide, no.normal$free.sulfur.dioxide, 
         method= "pearson")
```
<p>If I excluded the two outliers on the right:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = total.sulfur.dioxide, y = free.sulfur.dioxide, 
                      color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1) +
  xlim(0, 130)
```

<p>Most are concentrated towads 0, but as the points spread out more, the 
levels on both attributes increase. In this relationship, however, I don't see 
anything significant that are correlated to quality.</p>

#### Citric Acid and Fixed Acidity

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = citric.acid, y = fixed.acidity, 
                      color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
cor.test(no.normal$citric.acid, no.normal$fixed.acidity, method= "pearson")
```

<p>And if I excluded outliers on both axis:</p>

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(no.normal, aes(x = citric.acid, y = fixed.acidity, 
                      color=quality.group)) +
  geom_point(alpha=0.6) + 
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1) +
  xlim(-0.02, 0.875) +
  ylim(4, 14)
```

<p>Citric acid and fixed acidity have a strong correlation of 0.73. Although the 
line shows weak seperation of the quality groups, the poor group seems to be 
concentrated on fixed acidity level 6-9 and citric acid level 0 to 0.125., while 
the excellent group is concentrated in the middle of the plot.</p>

## Multivariate Analysis

<p class="question">Talk about some of the relationships you observed in this 
part of the investigation. Were there features that strengthened each other in 
terms of looking at your feature(s) of interest?</p>
<p class="answer">From the previous analysis, I found that alcohol had the 
strongest correlation with quality, so I wanted to choose an attribute that had 
the strongest correlation with alcohol, and run their relationship by quality. 
The plot had a good seperation between excellent and poor wines. I also checked 
where these quality groups were in each attributes pairs that had the strongest 
correlations, and density and fixed acidity also had a strong correlation with 
quality. </p>

<p class="question">Were there any interesting or surprising interactions 
between features?</p>
<p class="answer">It was interesting to see that some pairs would have a strong 
correlation with each other, but that doesn't always contribute to quality. 
This investigation has become a lot more complex and difficult than I 
expected.</p>


## Final Plots and Summary

<p class="question">Plot One</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_One}
ggplot(data=red, aes(x=quality)) +
  geom_bar(fill="#7a0011") +
  scale_x_continuous(breaks = 0:10) +
  ggtitle("Distribution of Quality") +
  labs(x="Quality of Wine", y="Count") +
  theme(plot.title = element_text(color="#333333", face="bold", size=17, hjust=0),
        axis.title = element_text(color="#666666", face="bold", size=12),
        axis.title.x=element_text(vjust=-2.5),
        axis.title.y=element_text(angle=90, vjust=2.5),
        panel.grid.minor = element_blank(),
        plot.margin = unit(c(1,1,1,1), "cm"))
```

<p>In the range of 0 to 10, most of the wines in this dataset were rated as 
"normal", between 5 and 6. This was important to be noted in order to determine 
the direction of the later analysis. When focusing on the overall observations, 
it became difficult to find any direct correlation with the quality because most 
wines were "normal". When I pinpointed my focus on the "non-normal" wines, I was 
able to find some interesting facts.</p>

<p class="question">Plot Two</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=12, fit.hight=15, Plot_Two}
p1 <- plot_att1(no.normal$alcohol, "Alcohol (% by volume)")
p2 <- plot_att1(no.normal$volatile.acidity, "Volatile Acidity (g / dm^3)")
p3 <- plot_att1(no.normal$citric.acid, "Citric Acid (g / dm^3)")
p4 <- plot_att1(no.normal$sulphates, "Sulphates (g / dm3)")

grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
             p2 + theme(legend.position="none"),
             p3 + theme(legend.position="none"),
             p4 + theme(legend.position="none"),
             ncol=2),
             top=textGrob("Attributes by Quality Group",
                          gp=gpar(fontsize=20, fontface = 'bold')))
```

<p>Out of all the attributes, alcohol has the strong correlation with quality.
When I removed ones with their quality 5 and 6, which were the majority of 
distribution, the attribute correlations became stronger with quality. Above 
shows the attributes with the strongest correlation.</p>

<p class="question">Plot Three</p>

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three, fig.height=10, fig.width=12}
p1 <- ggplot(no.normal, aes(x = density, y = alcohol, color=quality.group)) +
    geom_point(alpha=0.6, size=2) +
      scale_color_manual(values=c("#888888", "#E69F00"), 
                         labels = c("Poor  ", "Excellent ")) +
    geom_smooth(method = "lm", se = FALSE,size=1) +
    labs(x=NULL, y="Alcohol (% by volume)", color = " Quality Group: ") +
    theme(legend.position="top",
          legend.text = element_text(size = 15),
          legend.title = element_text(size = 15),
          legend.background = element_rect(fill="white",
                                    size=0.7, linetype="solid", 
                                    colour ="#cccccc"),
          legend.key = element_rect(size = 5),
          legend.key.size = unit(2, 'lines'))

p2 <- ggplot(no.normal, aes(x = density, y = fixed.acidity, color=quality.group)) +
  geom_point(alpha=0.6, size=2) +
    scale_color_manual(values=c("#888888", "#E69F00")) +
  geom_smooth(method = "lm", se = FALSE,size=1) +
  labs(x="Density (g / cm^3)", y="Fixed acidity (g / dm^3)")

#extracting legend
g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend<-g_legend(p1)

grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
             p2 + theme(legend.position="none"), ncol=1),
             mylegend, 
             nrow=2,
             heights=c(10, 1), 
             
             top=textGrob("Comparing Density with Alcohol and Fixed Acidity by Quality",
                          gp=gpar(fontsize=20, fontface = 'bold')))
```

<p>When looking at the quality, the strong correlations were observed between 
density and alcohol, and density and fixed acidity. The lower the alcohol level, 
the higher the density is, while the wines with higher alcohol level tend to be 
better in quality. The higher the density, the higher the fixed acidity, while 
the wines with higher fixed acidity tend to be better in quality.</p>


## Reflection

<p>When I first chose this detaset, I had an assumption that these attributes 
would somehow have direct influence on wine quality. However, all the 
correlation were weak to moderate, and the strongest correlation was with 
alcohol. The distribution showed that most wines were rated 5 and 6, and in 
order to see the better difference in what makes wines good and bad, I've 
removed those two qualities from the dataset and compared the highest and lowest 
ones. Only then I saw which attributes were correlated with bigger difference 
between the "excellent" and "poor". Attributes that had strong correlations with 
excellent wine was:<br><br>
- Higher alcohol<br>
- Lower volatile acidity<br>
- Higher citric acid <br>
- Higher sulphates</p>

<p>I then decided to investigate relationships of attributes, and I saw much 
stronger correlation in them. In the corelation plot, the ones with the 
strongest correlations were:<br><br>
- pH and fixed acidity<br>
- Density and fixed acidity <br>
- Total sulfur dioxide and free fulfur dioxide<br>
- Citric acid and fixed acidity</p>

<p>When compared with the quality, ones with density had the strongest 
correlation. This is understandable since it's influenced by the percent alcohol 
and sugar content. The trend in their relationships are:<br><br>
- The lower the alcohol level, the higher the density is, while the wines with 
higher alcohol level tend to be better in quality.<br>
- The higher the density, the higher the fixed acidity, while the wines with 
higher fixed acidity tend to be better in quality.</p>

<p>The issue became more and more evident as I moved along in the process. The 
quality judged by people are not absolute, however experts they are in the field. 
And flavors of wine are so complex and interwined with each attribute that it is 
very difficult to determin what exactly makes good or bad wine. But perhaps with 
more observations, it would become more possible to make predictions.</p> 

<p>Source: 
https://github.com/hadley/ggplot2/wiki/Share-a-legend-between-two-ggplot2-graphs</p>
